# í”„ë¡œì íŠ¸ ë§¤ë‹ˆì € Read Me


> í”„ë¡œì íŠ¸ ê¸°ê°„: 2022-06-13 ~ 2022-07-01
> 
> íŒ€ì›: [ìš°ë¡±ì°¨](https://github.com/dnwhd0112), [íŒŒí”„ë¦¬](https://github.com/papriOS) 
> 
> ë¦¬ë·°ì–´: [ìŠ¤í‹°ë¸](https://github.com/stevenkim18)

## ğŸ” í”„ë¡œì íŠ¸ ì†Œê°œ

í”„ë¡œì íŠ¸ ê´€ë¦¬ëŠ”! í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €!

## ì‹¤í–‰í•˜ê¸°ì „
pod install í•´ì£¼ì„¸ìš”!

## ğŸ‘€ PR
- [STEP1](https://github.com/yagom-academy/ios-project-manager/pull/121)
- [STEP2](https://github.com/yagom-academy/ios-project-manager/pull/143)
- [STEP3]

## ğŸ›  ê°œë°œí™˜ê²½ ë° ê¸°ìˆ ìŠ¤íƒ
- [![swift](https://img.shields.io/badge/swift-5.6-orange)]()
- [![xcode](https://img.shields.io/badge/Xcode-13.4.1-blue)]()
- [![iOS](https://img.shields.io/badge/iOS-14.4-red)]()

|UIêµ¬í˜„|local db|remote db|
|------|---|---|
|UIKit|Realm|MongoDB Atlas|


## íƒ€ì„ë¼ì¸
- [x] ì²«ì§¸ì£¼ : UIêµ¬í˜„ ë° ê¸°ìˆ  ìŠ¤íƒ ì„ íƒ
- [x] ë‘˜ì§¸ì£¼ : UIêµ¬í˜„, ìš”êµ¬ì‚¬í•­ êµ¬í˜„ ë° ì½”ë“œ ë¦¬í™í† ë§
- [ ] ì…‹ì§¸ì£¼ : 

## í”„ë¡œì íŠ¸ êµ¬ì¡°


## í”„ë¡œì íŠ¸ ì‹¤í–‰ í™”ë©´

|Task ìƒì„±|Task ì‚­ì œ|
|------|---|
|![](https://i.imgur.com/GipSEzp.gif)|![](https://i.imgur.com/psPimMt.gif)|

|Task ì´ë™|Task ìˆ˜ì •|
|------|---|
|![](https://i.imgur.com/Jn8nJwl.gif)|![](https://i.imgur.com/1JsHxE8.gif)

|Task ìˆ˜ì •ì·¨ì†Œ|Task ìƒì„±ì·¨ì†Œ|ë³€ê²½ ë‚´ì—­(History) í™•ì¸|
|---|---|---|
|![](https://i.imgur.com/J8oQr2E.gif)|![](https://i.imgur.com/Ik7C79d.gif)|![](https://i.imgur.com/nxvbuBX.gif)|

|ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹œ realtime db ì‹¤ì‹œê°„ ì—°ë™|
|---|
|![](https://i.imgur.com/wxOaZPo.gif)|



## ğŸš€ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
### STEP1ï¸âƒ£ : UIêµ¬í˜„ ë° ê¸°ìˆ  ìŠ¤íƒ ì„ íƒ
---

### Realm 
| about | ì¥ì  | ë‹¨ì  |
| --- | --- | --- |
| ë¹ ë¥´ê³ , ë°˜ì‘ì ì´ê³ , í™•ì¥ì´ ìš©ì´í•˜ë‹¤.ì €ì¥, ë™ê¸°í™”, ë°ì´í„° ì¿¼ë¦¬ing ì„ ê°„ë‹¨í•˜ê²Œ ì§„í–‰í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤ | ë°ì´í„° ê°ì²´ë¥¼ Realmì— ê°ì²´í˜•íƒœë¡œ ì €ì¥í•˜ì—¬ DBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê°€ê³µê³¼ì •ì—†ì´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ORM/DAOê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤.                  MongoDB Atlasì™€ Device Syncë¡œ í´ë¼ìš°ë“œ ë™ê¸°í™”ë¥¼ ì§€ì›í•œë‹¤. ë˜í•œ ì‰½ê³  ë¯¿ìŒì§ìŠ¤ëŸ½ê²Œ ì•± í¼í¬ë¨¼ìŠ¤ë¥¼ ë‚®ì¶”ì§€ ì•Šê³  ë””ë°”ì´ìŠ¤ì— ë°ì´í„°ë¥¼ ì˜êµ¬ì €ì¥í•  ìˆ˜ ìˆë‹¤. | 3rd party ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ë¡œ ì¸í•´ ì•±ì˜ í¬ê¸°ê°€ ëŠ˜ì–´ë‚œë‹¤. SQLiteë‚˜ Firebaseì— ë¹„í•´ ì»¤ë®¤ë‹ˆí‹°ê°€ ì‘ë‹¤.          Reamì˜ sync ê¸°ëŠ¥ì´ AWSì—ì„œë§Œ ê°€ëŠ¥í•˜ë‹¤. |
### MongoDB Atlas

MongoDB Atlasì™€ Device Syncë¡œ í´ë¼ìš°ë“œ ë™ê¸°í™”ë¥¼ ì§€ì›í•œë‹¤.


### ì„ íƒ ì´ìœ ì™€ ê³ ë ¤ì‚¬í•­

    
#### 1. í•˜ìœ„ ë²„ì „ í˜¸í™˜ì„±ì—ëŠ” ë¬¸ì œê°€ ì—†ëŠ”ê°€?
#### Realm
| Realm| MongoDB Atlas |
| --- | --- |
|Xcode 11.3 ì´ìƒ,  iOS 9 ì´ìƒ| í•´ë‹¹ì‚¬í•­ ì—†ìŒ |


#### 2. ì•ˆì •ì ìœ¼ë¡œ ìš´ìš© ê°€ëŠ¥í•œê°€?
| Realm| MongoDB Atlas |
| --- | --- |
| CoreData ë³´ë‹¤ ì‘ì—…ì†ë„ê°€ ë¹ ë¥´ê³  Realm Studioë¥¼ í†µí•´ DBìƒíƒœë¥¼ í¸í•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. MongoDBê°€ ìš´ì˜í•˜ê¸° ë•Œë¬¸ì— ì•ˆì •ì ìœ¼ë¡œ ìš´ìš© ê°€ëŠ¥í•˜ë‹¤ê³  ë³´ì¸ë‹¤.| Realmì„ ì¸ìˆ˜í•œ MongoDBì‚¬ì—ì„œ ë§Œë“  ë©€í‹° í´ë¼ìš°ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° í”Œë«í¼ì´ë‹¤. ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë°°í¬ ë° ê´€ë¦¬í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤. |  



#### 3. ë¯¸ë˜ ì§€ì†ê°€ëŠ¥ì„±ì´ ìˆëŠ”ê°€?

| Realm| MongoDB Atlas |
| --- | --- |
| ìµœê·¼ MongoDBê°€ ì¸ìˆ˜í•˜ì˜€ê¸°ì— ë¯¸ë˜ ì§€ì†ê°€ëŠ¥ì„±ì´ ë†’ì•„ë³´ì¸ë‹¤. | í˜„ì¬ ì—¬ëŸ¬ ê¸°ì—…ì— ì„œë¹„ìŠ¤ë¥¼ í•˜ëŠ” ì¤‘ì„ìœ¼ë¡œ ë¯¸ë˜ ì§€ì† ê°€ëŠ¥ì„±ì´ ë†’ë‹¤ê³  ë³¸ë‹¤. |

#### 4. ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™” í•  ìˆ˜ ìˆëŠ”ê°€? ì•Œê³ ìˆëŠ” ë¦¬ìŠ¤í¬ëŠ” ë¬´ì—‡ì¸ê°€?

#### Realm

* ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ Thread safetyë¥¼ ìœ ì˜í•´ì•¼í•œë‹¤

realmì€ `@ThreadSafe Wrapper`, `writeAsync` ë“± ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ thread safetyí•œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ê³  ìˆë‹¤. 
[Realm Threading](https://www.mongodb.com/docs/realm/sdk/swift/advanced-guides/threading/)
[perform a background write](https://www.mongodb.com/docs/realm/sdk/swift/examples/read-and-write-data/#std-label-ios-async-write)


#### MongoDB Atlas

íŒŒì´ì–´ ë² ì´ìŠ¤ì™€ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ê²ƒìœ¼ë¡œ ì•Œê³ ìˆì§€ë§Œ ê´€ë ¨ ë¬¸ì„œê°€ ë„ˆë¬´ ì ê³  ì‚¬ìš©ì‚¬ë¡€ë„ ì ë‹¤. Realmê³¼ ë†’ì€ ì—°ë™ì„±ì„ ë°”ë¼ë³´ê³  ì‚¬ìš©í•  ì˜ˆì •ì´ë‹¤. -> ëª»ì¨ë¨¹ê² ë‹¤ ìš”êµ¬í•˜ëŠ”ê²Œ ë„ˆë¬´ ë§ë‹¤.
[ê³µì‹ íŠœí† ë¦¬ì–¼](https://www.mongodb.com/docs/realm/tutorial/ios-swift/)

#### 5. ì–´ë–¤ ì˜ì¡´ì„± ê´€ë¦¬ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ”ê°€?
#### Realm
- CocoaPod
- Carthage
- SPM

ìš°ë¦¬ëŠ” `CocoaPod`ì„ ì´ìš©í•˜ì—¬ ê´€ë¦¬í•˜ì˜€ë‹¤. 
    
#### 6. ì´ ì•±ì˜ ìš”êµ¬ê¸°ëŠ¥ì— ì ì ˆí•œ ì„ íƒì¸ê°€?
ì´ ì•±ì˜ ì£¼ìš”ê¸°ëŠ¥ì„ ìš°ë¦¬ëŠ”
1. í”„ë¡œì íŠ¸ ê´€ë¦¬
2. ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ ë³¼ ìˆ˜ ìˆë„ë¡ ë™ê¸°í™”ê°€ ì£¼ ìš”ì†Œë¼ê³  ìƒê°í•œë‹¤.

---
### STEP2ï¸âƒ£ : UI êµ¬í˜„, ìš”êµ¬ì‚¬í•­ êµ¬í˜„ ë° ì½”ë“œ ë¦¬íŒ©í† ë§

### ğŸš€í•˜ë‚˜ì˜ ViewControllerì—ì„œ 3ê°€ì§€ TableViewë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•

TODO, DOING, DONE 3ê°€ì§€ Taskì˜ ì¢…ë¥˜ë¥¼ ë‹´ëŠ” TableView 3ê°€ì§€ê°€ í•„ìš”í–ˆë‹¤.
```swift
enum TaskType: String, CaseIterable {
    case todo
    case doing
    case done
}
```
enumìœ¼ë¡œ ì¼€ì´ìŠ¤ë¥¼ ë§Œë“ ë’¤

```swift
// private typealias DataSource = UITableViewDiffableDataSource<Int, Task>
private var dataSources: [TaskType: DataSource] = [:]
private var tableViews: [TaskType: UITableView]
```
Dictionaryë¥¼ ì‚¬ìš©í•´ 3ê°€ì§€ tableViewì™€ dataSourceë¥¼ ê´€ë¦¬í–ˆë‹¤.



### ğŸš€í…Œì´ë¸”ê³¼ ë°ì´í„°ì˜ ê´€ë¦¬

UIDiffableTableViewDataSourceë¥¼ ì‚¬ìš©í•˜ì—¬ ë³„ë„ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥ë  ë°ì´í„°ì €ì¥ì†Œ(ë°°ì—´ ë“±)ì„ ë”°ë¡œ ë‘ì§€ì•Šê³ , dataSourceë¡œ ë°ì´í„°ë¥¼ ê´€ë¦¬í–ˆë‹¤.

TableViewì˜ dataSourceì—ì„œ ë°ì´í„°(Task)ë¥¼ ì‚­ì œí•˜ëŠ” ê³¼ì •ì—ì„œ 
í•´ë‹¹ Taskì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” cellì˜ indexPath ë˜í•œ ì•Œì•„ì•¼ í–ˆê¸° ë•Œë¬¸ì—
```swift
struct TaskInfo {
    let task: Task
    let type: TaskType
    let indexPath: IndexPath
}
```
TaskInfo êµ¬ì¡°ì²´ë¥¼ ë§Œë“¤ì–´ ì´ë¥¼ í†µí•´ ê´€ë¦¬í–ˆë‹¤.


## âœï¸ í•™ìŠµë‚´ìš©
`Realm`
`MongoDB Atlas`

pop view Controller ì‚¬ìš© ë²•
ë³„ë„ì˜ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ì–´ì¤€ë’¤ ì‚¬ìš©í•œë‹¤. ì´ë•Œ ë„ìš°ëŠ” ë°©í–¥ì´ë‚˜ ì‚¬ì´ì¦ˆëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤.

```swift=
let popoverController = PopoverViewController(taskInfo: taskInfo)
        popoverController.delegate = self
        popoverController.modalPresentationStyle = .popover 
        popoverController.preferredContentSize = CGSize(width: 200, height: 100) //ì‚¬ì´ì¦ˆ ì§€ì •
        
        let popover = popoverController.popoverPresentationController
        popover?.sourceView = mainView.retrieveTableView(taskType: taskInfo.type) // ë³´ì—¬ì£¼ëŠ” ë·° ì„¤ì •
        popover?.sourceRect = CGRect(x: point.x, y: point.y, width: 0, height: 0 ) // ë³´ì—¬ì£¼ëŠ” ìœ„ì¹˜ ì„¤ì •(width, heightëŠ” ë¬´ì‹œëœë‹¤)
        popover?.permittedArrowDirections = .up // ë³´ì—¬ì£¼ëŠ” ë°©í–¥ ì„¤ì •
        
        present(popoverController, animated: true)
```

### STEP3ï¸âƒ£ : Firebase ì—°ë™ ë° ì‹¤ì‹œê°„ ë™ê¸°í™” ì ìš©, history ëª©ë¡ êµ¬í˜„

### êµ¬í˜„ ê¸°ëŠ¥

### ğŸš€ 1. ë¡œì»¬ db(realm)ì™€ ë¦¬ëª¨íŠ¸ db(firebase realtime db) ê°„ ë™ê¸°í™”

#### 1-1. ë„¤íŠ¸ì›Œí¬ ì ‘ì† ì‹œ ì˜¤í”„ë¼ì¸ì—ì„œ ë°œìƒí•œ ë³€ê²½ì‚¬í•­ì„ firebase realtime dbì— ì ìš©

```swift
Database.database().isPersistenceEnabled = true
```
ìœ„ì˜ ì½”ë“œë¡œ ë””ìŠ¤í¬ ì§€ì†ì„±ì„ ì‚¬ìš© ì„¤ì •

#### 1-2. Firebase ì‹¤ì‹œê°„ ì—°ë™
ì„œë²„ë¡œ ë¶€í„° ë°ì´í„° ë³€ê²½ì´ ìˆì„ë•Œ ì•ŒëŒì„ ë°›ì„ìˆ˜ ìˆë„ë¡ êµ¬ì„±
ì¶”ê°€ - DataEventType.childAdded
ë³€ê²½ - DataEventType.childChanged
ì‚­ì œ - DataEventType.childRemoved

```swift
    func observe<T: FirebaseDatable>(_: T.Type) {
        let observeRef = T.path.reduce(database) { database, path in
            database.child(path)
        }
        
        observeRef.observe(DataEventType.childAdded) { snapshot in
            self.firebaseEventObserveDelegate?.added(snapshot: snapshot)
            // 
        }
        
        observeRef.observe(DataEventType.childChanged) { snapshot in
            self.firebaseEventObserveDelegate?.changed(snapshot: snapshot)
        }
        
        observeRef.observe(DataEventType.childRemoved) { snapshot in
            self.firebaseEventObserveDelegate?.removed(snapshot: snapshot)
        }
    }
```
ë‹¤ë§Œ ì´ë•Œ ì²˜ìŒ ë°ì´í„°ë¥¼ ë°›ì„ë•Œë„ childAddedê°€ ì‹¤í–‰ëœë‹¤. ìš°ë¦¬ëŠ” ë¡œì»¬ ì„œë²„ìœ„ì£¼ë¡œ ë°ì´í„°ë¥¼ êµ¬ì„±í–ˆìœ¼ë¯€ë¡œ ë§Œì•½ ë¡œì»¬ ë°ì´í„°ì— ì´ë¯¸ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì–´ìˆë‹¤ë©´ ì¶”ê°€ë¥¼ ìƒëµí•˜ëŠ” ì½”ë“œë„ ë„£ì–´ì¤¬ì—ˆë‹¤.

### ğŸš€ 2. History êµ¬í˜„ - ë³€ê²½ë‚´ì—­ ê¸°ë¡
ì•± ì‹¤í–‰ ì‹œ í˜„ì¬ ê¸°ê¸°ì—ì„œ ë³€ê²½í•œ ë‚´ìš©ì´ ìˆìœ¼ë©´ í•´ë‹¹ ê¸°ê¸°ì—ì„œ ìˆ˜ì •í•œ Historyê°€ ë³´ì´ê²Œë” êµ¬ì„±. 
íˆìŠ¤í† ë¦¬ë¥¼ ë³´ì—¬ì¤„ë•Œ ìœ„ì˜ ì‹¤ì‹œê°„ ì—°ë™ìœ¼ë¡œ ì¶”ê°€í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ í•œê²ƒì€ ë³´ì—¬ì£¼ê¸¸ ì›í•˜ì§€ ì•Šì•˜ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ë¡œì»¬í™˜ê²½ì—ì„œ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œê°€ ë ë•Œë§Œ íˆìŠ¤í† ë¦¬ë¥¼ ì¶”ê°€í•˜ë„ë¡ í•˜ì˜€ë‹¤. 
ë˜í•œ historys ë¼ëŠ” ë°°ì—´ì— ë§Œë“¤ì–´ì§„ Historyê°ì²´ë¥¼ ì €ì¥í•˜ì—¬ ì•±ì´ ì¢…ë£Œë˜ë©´ í•´ë‹¹ ë°°ì—´ì´ ë¹„ì›Œì§„ë‹¤. - ì¦‰ ì•±ì´ ì‹¤í–‰ë˜ê³  ì¢…ë£Œë ë•Œê¹Œì§€ë§Œ ê¸°ë¡ì„ í•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.

### ğŸš€ 3. keyboard ë¬¸ì œ í•´ê²°
keyboardLayoutGuideë¥¼ í†µí•´ DetailModalViewì˜ TextViewê°€ í‚¤ë³´ë“œì— ê°€ë ¤ì§€ì§€ ì•Šë„ë¡ êµ¬í˜„í•˜ê³ ì í•˜ì˜€ë‹¤.
ì ìš©í•˜ê³  ì í•œ constraintê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì€ ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.

ì²«ë²ˆì§¸ ì›ì¸: layoutì„ ë°”ê¿€ë•Œ ê¸°ì¡´ layoutì˜ í•´ì œë¥¼ í•´ì£¼ì§€ ì•Šì•˜ë‹¤
```swift=
//ë¬¸ì œê°€ ëœ ë¶€ë¶„, ê·¸ëƒ¥ ìƒˆë¡œìš´ constraintë¡œ ë³€ê²½í•œë‹¤.
bottomConstraint = stackView.bottomAnchor.constraint(equalTo: keyboardLayoutGuide.topAnchor)

//ìˆ˜ì • - ê¸°ì¡´ constraintë¥¼ í•´ì œí•˜ê³  ë‹¤ì‹œ í™œì„±í™” ì‹œí‚¨ë‹¤.
bottomConstraint.isActive = false
bottomConstraint = stackView.heightAnchor.constraint(equalTo: self.heightAnchor, multiplier: 0.5)
bottomConstraint.isActive = true
```
ë‘ë²ˆì§¸ ì›ì¸: keyboardLayoutGuideê°€ ì œëŒ€ë¡œ frameì„ ì¡ì§€ ëª»í•˜ì˜€ë‹¤.
í•´ë‹¹ ë¬¸ì œëŠ” í•´ê²°í•˜ì§€ ëª»í•´ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ constraintë¥¼ ì ìš©í•˜ì˜€ë‹¤.

### ğŸš€ 4. TextView Layer ë¬¸ì œ í•´ê²°
TextView í…Œë‘ë¦¬ì— ê·¸ë¦¼ìê°€ ì§„ íš¨ê³¼ë¥¼ ì£¼ê¸° ìœ„í•˜ì—¬
```
textView.layer.masksToBounds = false 
```
í•´ë‹¹ ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ë‹¤.
ì´ ë•Œë¬¸ì— textViewì— í•´ë‹¹ textViewì˜ frameì„ ë„˜ê¸¸ ë§Œí¼ ê¸´ ê¸€ì„ ë„£ìœ¼ë©´ 
ë°”ê¹¥ê¹Œì§€ ìŠ¤í¬ë¡¤ì´ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì—¬ ìœ„ì˜ ì½”ë“œë¥¼ ì‚­ì œí•˜ê³  ê²€ì • ì„ ì˜ í…Œë‘ë¦¬ë¥¼ ê°–ë„ë¡ ë³€ê²½í•˜ì˜€ë‹¤.
